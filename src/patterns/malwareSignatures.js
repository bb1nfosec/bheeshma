/**
 * BHEESHMA Malware Signature Database
 * 
 * Known malicious patterns found in supply chain attacks.
 * These signatures are based on real-world npm package compromises.
 * 
 * Security: Transparent detection - all patterns are documented
 */

'use strict';

/**
 * Known cryptocurrency miner indicators
 */
const CRYPTO_MINER_PATTERNS = {
    // Common miner binaries
    processes: [
        'xmrig',
        'ccminer',
        'ethminer',
        'cpuminer',
        'minerd'
    ],

    // Mining pool domains
    domains: [
        'moneroocean.stream',
        'pool.hashvault.pro',
        'pool.supportxmr.com',
        'pool.minexmr.com',
        'xmr.nanopool.org'
    ],

    // Mining-related environment variables
    envVars: [
        'WALLET_ADDRESS',
        'MINING_POOL',
        'WORKER_NAME'
    ]
};

/**
 * Data exfiltration patterns
 */
const DATA_EXFILTRATION_PATTERNS = {
    // Commonly exfiltrated files
    sensitiveFiles: [
        '.npmrc',
        '.env',
        '.aws/credentials',
        '.ssh/id_rsa',
        '.ssh/id_ed25519',
        '.gitconfig',
        '.docker/config.json',
        'package-lock.json'
    ],

    // Services used for exfiltration
    exfiltrationServices: [
        'pastebin.com',
        'paste.ee',
        'hastebin.com',
        'webhook.site',
        'requestbin.com',
        'pipedream.com'
    ],

    // Suspicious POST patterns
    largePostIndicators: {
        minSize: 100000, // 100KB
        suspiciousHeaders: ['x-api-key', 'x-auth-token']
    }
};

/**
 * Backdoor patterns
 */
const BACKDOOR_PATTERNS = {
    // Reverse shell indicators
    reverseShellCommands: [
        'nc -e /bin/sh',
        '/bin/bash -i',
        'python -c',
        'perl -e',
        'ruby -rsocket'
    ],

    // Listening ports (non-standard)
    suspiciousPorts: [
        1337, 4444, 5555, 6666, 7777, 8888, 9999,
        31337 // classic hacker port
    ],

    // Remote access tools
    ratTools: [
        'ngrok',
        'localtunnel',
        'serveo'
    ]
};

/**
 * Obfuscation patterns
 */
const OBFUSCATION_PATTERNS = {
    // Suspicious eval/Function usage
    dynamicCodePatterns: [
        /eval\s*\(/,
        /Function\s*\(/,
        /new\s+Function/,
        /setTimeout\s*\(\s*['"`]/,
        /setInterval\s*\(\s*['"`]/
    ],

    // Base64 encoded code indicators
    encodingPatterns: [
        /atob\s*\(/,
        /Buffer\.from\s*\(.*['"]base64/,
        /\.[decode|fromBase64]\s*\(/
    ],

    // Hex encoded strings
    hexPatterns: [
        /\\x[0-9a-fA-F]{2}/,
        /0x[0-9a-fA-F]+/
    ]
};

/**
 * Typosquat patterns (package names similar to popular packages)
 */
const TYPOSQUAT_PATTERNS = {
    popularPackages: [
        'express',
        'react',
        'lodash',
        'axios',
        'moment',
        'request',
        'webpack',
        'eslint',
        'typescript',
        '@types/node'
    ],

    // Common typosquat techniques
    techniques: {
        // One letter off
        levenshteinDistance: 1,

        // Common letter swaps
        swaps: {
            'o': '0',
            'i': 'l',
            'e': '3'
        }
    }
};

/**
 * Credential theft patterns
 */
const CREDENTIAL_THEFT_PATTERNS = {
    // Environment variables commonly containing secrets
    secretEnvVars: [
        'AWS_ACCESS_KEY_ID',
        'AWS_SECRET_ACCESS_KEY',
        'GH_TOKEN',
        'GITHUB_TOKEN',
        'NPM_TOKEN',
        'SLACK_TOKEN',
        'DATABASE_URL',
        'API_KEY',
        'SECRET_KEY',
        'PRIVATE_KEY',
        'JWT_SECRET'
    ],

    // Files

    containing credentials
  credentialFiles: [
        '.env',
        '.env.local',
        '.env.production',
        'config.json',
        'secrets.json',
        '.npmrc',
        '.dockercfg',
        '.netrc'
    ]
};

module.exports = {
    CRYPTO_MINER_PATTERNS,
    DATA_EXFILTRATION_PATTERNS,
    BACKDOOR_PATTERNS,
    OBFUSCATION_PATTERNS,
    TYPOSQUAT_PATTERNS,
    CREDENTIAL_THEFT_PATTERNS
};
